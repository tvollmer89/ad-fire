function updateDataTableSelectAllCtrl(e){var t=e.table().node(),n=$('tbody input[type="checkbox"]',t),a=$('tbody input[type="checkbox"]:checked',t),i=$('thead input[name="select_all"]',e.table().container()).get(0);0===a.length?(i.checked=!1,"indeterminate"in i&&(i.indeterminate=!1)):a.length===n.length?(i.checked=!0,"indeterminate"in i&&(i.indeterminate=!1)):(i.checked=!0,"indeterminate"in i&&(i.indeterminate=!0))}function updateFilesArray(e){var t=[],n="designs/",a=".pdf";return $.each(e,function(e,n){var a="designs/".concat(n,".pdf"),i={filename:n.concat(".pdf"),url:a};t.push(i)}),t}function getTestingAuthority(){for(var e=document.getElementById("tAuth"),t=e.getElementsByTagName("input"),n,a=0;a<t.length;a++)if(t[a].checked){n=t[a].value;break}return n}var JSZip=require("jszip"),Q=require("q"),FileSaver=require("file-saver"),ProgressBar=require("progressbar.js"),downloadFile=function(e){var t=Q.defer(),n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(n.status<400?t.resolve(n.response):t.reject(new Error("Failed to load file from server")))},n.send(),t.promise};$(document).ready(function(){function e(){for(var e=document.getElementById("filters"),i=e.getElementsByTagName("input"),r=0,o=i.length;r<o;r++)"radio"===i[r].type&&"2"===i[r].name?i[r].onchange=t:"radio"===i[r].type&&"3"===i[r].name?i[r].onchange=n:"checkbox"!==i[r].type&&"radio"!==i[r].type||(i[r].onchange=a)}function t(){var e=getTestingAuthority();o.ajax.url("json/"+e+".json").load()}function n(){for(var e="",t=0;t<u.length;t++)u[t].checked===!0&&(e=u[t].value);""===e?($(".jFilter").hide(),$(".pFilter").hide(),$(".bFilter").hide()):"Joint"===e?(i(".pFilter"),$(".pFilter").hide(300,function(){$(".jFilter").show(300),$(".bFilter").show(300)})):"Penetration"===e&&(i(".jFilter"),$(".jFilter").hide(300,function(){$(".pFilter").show(300),$(".bFilter").show(300)})),c.fnFilter(e,3)}function a(){var e=$('input:radio[name="'+this.name+'"]:checked').map(function(){return this.value}).get().join("|"),t=$('input:checkbox[name="'+this.name+'"]:checked').map(function(){return this.value}).get().join("|"),n=e+t;c.fnFilter(n,this.name,!0,!1,!1,!0),console.log(n)}function i(e){var t=e;"all"===t&&(t="#filters"),$(t+' input[type="checkbox"]:checked').each(function(){this.click()}),$(t+' input[type="radio"]:checked').each(function(){this.checked=!1,c.fnFilter("",this.name,!0,!1,!1,!0)})}function r(){setTimeout(function(){p.set(0)},3e3)}var o=$("#systems").DataTable({ajax:"json/UL.json",responsive:{details:{type:"column",target:"tr",renderer:function(e,t,n){var a=$.map(n,function(e,t){if(""!==e.data){var n;return n=e.columnIndex>=14&&e.columnIndex<=22?'<li data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'" class="col-md-6">':'<li data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'" class="col-md-12">',e.hidden?n+'<span class="dtr-title">'+e.title+':</span> <span class="dtr-data">'+e.data+"</span></li>":""}}).join("");return!!a&&$('<ul class="col-md-12"/>').append(a)}}},columns:[{data:"selected"},{data:"designNumber",className:"design-num"},{data:"testingAuthority"},{data:"systemType"},{data:"jointType"},{data:"jointCondition"},{data:"maxJointWidth"},{data:"penetrationCons"},{data:"penetrationType"},{data:"maxSizePenetrant"},{data:"appMethod"},{data:"products",className:"products-col"},{data:"curtainWallType"},{data:"moveC"},{data:"fRating"},{data:"ftRating"},{data:"fhRating"},{data:"fthRating"},{data:"minASpace"},{data:"maxASpace"},{data:"sleeve"},{data:"insulationType"},{data:"lRating"},{data:"link",className:"pdf-col"}],columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:function(e,t,n,a){return'<input type="checkbox">'}},{targets:1,render:function(e,t,n,a){return'<i class="fa fa-chevron-down"></i><span>'+e+"</span>"}},{targets:[2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,20,21,22],className:"none"},{targets:[2,3,4,5,6,11,-1],orderable:!1},{responsivePriority:1,targets:0},{responsivePriority:2,targets:1},{responsivePriority:3,targets:-1},{responsivePriority:4,targets:11},{targets:23,data:"link",render:function(e,t,n,a){return'<a href="designs/'+e+'.pdf" download><i class="fa fa-download" aria-hidden="true"></i></a>'}}],infoCallback:function(e,t,n,a,i,r){return t+" - "+n+" of "+i},pageLength:25,language:{paginate:{previous:"‹",next:"›"},aria:{paginate:{previous:"Previous",next:"Next"}}},order:[[1,"asc"]],sDom:"<'row'<'col-sm-12'l>><'row'<tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",rowCallback:function(e,t,n){var a=t.designNumber;$.inArray(a,d)!==-1&&($(e).find('input[type="checkbox"]').prop("checked",!0),$(e).addClass("selected"))}}),c=$("#systems").dataTable(),d=[],s=[];document.getElementById("download-zip").disabled=!0;var l=document.getElementById("sType"),u=l.getElementsByTagName("input");e(),$("#tableSearch").on("keyup",function(){o.search(this.value).draw()}),$("#clear-all").click(function(){i("all");for(var e=document.getElementById("tAuth"),t=e.getElementsByTagName("input"),a=0,r=t.length;a<r;a++)"UL"===t[a].value?t[a].checked=!0:t[a].checked=!1;for(var o=0;o<u.length;o++)u[o].checked=!1;document.getElementById("tableSearch").value="",n(),c.api().ajax.url("json/UL.json").load().search("").draw()}),$("#systems tbody").on("click",'input[type="checkbox"]',function(e){var t=$(this).closest("tr"),n=c.api().row(t).data(),a=n.link,i=$.inArray(a,d);this.checked&&i===-1?d.push(a):this.checked||i===-1||d.splice(i,1),this.checked?t.addClass("selected"):t.removeClass("selected"),updateDataTableSelectAllCtrl(o),s=updateFilesArray(d),s.length>0?document.getElementById("download-zip").disabled=!1:0===s.length&&(document.getElementById("download-zip").disabled=!0),e.stopPropagation()}),c.on("draw",function(){updateDataTableSelectAllCtrl(o)});var p=new ProgressBar.Line("#progress",{color:"#666666",easing:"easeInOut",strokeWidth:2.1,svgStyle:{display:"block",width:"80%"}});$("#download-zip").on("click",function(){if(navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1)alert('This function is not supported by your browser. Please download files individally by clicking on the red icon in the "PDF Download" column.'),document.getElementById("download-zip").disabled=!0;else{p.animate(1);var e=new JSZip;s.reduce(function(t,n){return t.then(function(){return downloadFile(n.url).then(function(t){e.file(n.filename,t)})})},Q()).then(function(){function t(){return e.generateAsync({type:"blob"}).then(function(e){FileSaver.saveAs(e,"firestop-systems.zip")},function(e){blobLink.innerHTML+="<p>supported<p>"+e}),!1}function n(){e.generateAsync({type:"base64"}).then(function(e){window.location="data:application/zip;base64,"+e},function(e){})}JSZip.support.blob?t():(alert("not supported on this browser"),blobLink.innerHTML+=" (not supported on this browser)",n()),r()})}}),$('thead input[name="select_all"]',o.table().container()).on("click",function(e){this.checked?$('#systems tbody input[type="checkbox"]:not(:checked)').trigger("click"):this.indeterminate?$('#systems tbody input[type="checkbox"]:checked').trigger("click"):$('#systems tbody input[type="checkbox"]:checked').trigger("click"),e.stopPropagation()})});