function updateDataTableSelectAllCtrl(e){var t=e.table().node(),a=$('tbody input[type="checkbox"]',t),n=$('tbody input[type="checkbox"]:checked',t),i=$('thead input[name="select_all"]',e.table().container()).get(0);0===n.length?(i.checked=!1,"indeterminate"in i&&(i.indeterminate=!1)):n.length===a.length?(i.checked=!0,"indeterminate"in i&&(i.indeterminate=!1)):(i.checked=!0,"indeterminate"in i&&(i.indeterminate=!0))}function updateFilesArray(e){var t=[],a="designs/",n=".pdf";return $.each(e,function(e,a){var n="designs/".concat(a,".pdf"),i={filename:a.concat(".pdf"),url:n};t.push(i)}),t}var JSZip=require("jszip"),Q=require("q"),FileSaver=require("file-saver"),downloadFile=function(e){var t=Q.defer(),a=new XMLHttpRequest;return a.open("GET",e,!0),a.responseType="arraybuffer",a.onreadystatechange=function(){4===a.readyState&&(a.status<400?t.resolve(a.response):t.reject(new Error("Failed to load file from server")))},a.send(),t.promise};$(document).ready(function(){function e(){for(var e=document.getElementById("filters"),t=e.getElementsByTagName("input"),n=0,i=t.length;n<i;n++)"checkbox"===t[n].type?t[n].onchange=a:"radio"===t[n].type&&"2"===t[n].name&&(t[n].onchange=a)}function t(){i.api().draw()}function a(){var e=$('input:radio[name="'+this.name+'"]:checked').map(function(){return"ULC"===this.value?"ULC|cUL":"^"+this.value+"$"}).get().join("|"),t=$('input:checkbox[name="'+this.name+'"]:checked').map(function(){return this.value}).get().join("|"),a=e+t;i.fnFilter(a,this.name,!0,!1,!1,!0)}$("#systems").DataTable({ajax:"json/ULC.json",responsive:{details:{type:"column",target:"tr",renderer:function(e,t,a){var n=$.map(a,function(e,t){if(""!==e.data){var a;return a=e.columnIndex>=12&&e.columnIndex<=19?'<li data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'" class="col-md-6">':'<li data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'" class="col-md-12">',e.hidden?a+'<span class="dtr-title">'+e.title+':</span> <span class="dtr-data">'+e.data+"</span></li>":""}}).join("");return!!n&&$('<ul class="col-md-12"/>').append(n)}}},columns:[{data:"selected"},{data:"designNumber",className:"design-num"},{data:"testingAuthority"},{data:"systemType"},{data:"jointType"},{data:"jointCondition"},{data:"maxJointWidth"},{data:"penetrationCons"},{data:"penetrationType"},{data:"maxSizePenetrant"},{data:"appMethod"},{data:"moveC"},{data:"fRating"},{data:"ftRating"},{data:"fhRating"},{data:"fthRating"},{data:"minASpace"},{data:"maxASpace"},{data:"sleeve"},{data:"insulationType"},{data:"lRating"},{data:"moldMildew"},{data:"seismic"},{data:"wRating"},{data:"stcRating"},{data:"trade"},{data:"products"},{data:"link"}],columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:function(e,t,a,n){return'<input type="checkbox">'}},{targets:1,render:function(e,t,a,n){return'<i class="fa fa-chevron-down"></i><span>'+e+"</span>"}},{targets:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],className:"none"},{targets:[2,3,4,5,6,-1],orderable:!1},{responsivePriority:1,targets:0},{responsivePriority:2,targets:1},{responsivePriority:3,targets:-1},{targets:27,data:"link",render:function(e,t,a,n){return'<a href="designs/'+e+'.pdf" download><i class="fa fa-download" aria-hidden="true"></i></a>'}}],infoCallback:function(e,t,a,n,i,o){return t+" - "+a+" of "+i},pageLength:25,language:{paginate:{previous:"‹",next:"›"},aria:{paginate:{previous:"Previous",next:"Next"}}},order:[[1,"asc"]],sDom:"<'row'<'col-sm-12'l>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",rowCallback:function(e,t,a){var n=t.designNumber;$.inArray(n,o)!==-1&&($(e).find('input[type="checkbox"]').prop("checked",!0),$(e).addClass("selected"))}});var n=$("#systems").DataTable(),i=$("#systems").dataTable(),o=[],r=[];document.getElementById("download-zip").disabled=!0,$("#tableSearch").on("keyup",function(){i.api().search(this.value).draw()}),e(),$("#clear-all").click(function(){$("#filters input[type=checkbox]:checked").each(function(){this.click()});for(var e=document.getElementById("tAuth"),t=e.getElementsByTagName("input"),a=0,n=t.length;a<n;a++)"ULC"===t[a].value?t[a].checked=!0:t[a].checked=!1;document.getElementById("tableSearch").value="",i.fnFilter("ULC|cUL",2,!0,!1,!1,!0),i.api().search("").draw()}),$("#systems tbody").on("click",'input[type="checkbox"]',function(e){var t=$(this).closest("tr"),a=i.api().row(t).data(),c=a.link;console.log(c);var d=$.inArray(c,o);this.checked&&d===-1?o.push(c):this.checked||d===-1||o.splice(d,1),console.log(o),this.checked?t.addClass("selected"):t.removeClass("selected"),updateDataTableSelectAllCtrl(n),r=updateFilesArray(o),r.length>0?document.getElementById("download-zip").disabled=!1:0===r.length&&(document.getElementById("download-zip").disabled=!0),e.stopPropagation()}),i.on("draw",function(){updateDataTableSelectAllCtrl(n)}),$("#download-zip").on("click",function(){var e=new JSZip;r.reduce(function(t,a){return t.then(function(){return downloadFile(a.url).then(function(t){e.file(a.filename,t)})})},Q()).then(function(){function t(){return e.generateAsync({type:"blob"}).then(function(e){FileSaver.saveAs(e,"firestop-systems.zip")},function(e){blobLink.innerHTML+=" "+e}),!1}function a(){e.generateAsync({type:"base64"}).then(function(e){window.location="data:application/zip;base64,"+e},function(e){})}JSZip.support.blob?t():(blobLink.innerHTML+=" (not supported on this browser)",a())})}),$('thead input[name="select_all"]',n.table().container()).on("click",function(e){this.checked?$('#systems tbody input[type="checkbox"]:not(:checked)').trigger("click"):this.indeterminate?$('#systems tbody input[type="checkbox"]:checked').trigger("click"):$('#systems tbody input[type="checkbox"]:checked').trigger("click"),e.stopPropagation()})});