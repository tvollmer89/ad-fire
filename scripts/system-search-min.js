function bindEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function updateDownloadButton(e){files=e,zip=new JSZip,files.reduce(function(e,t){return e.then(function(){return downloadFile(t.url).then(function(e){zip.file(t.filename,e),console.log(zip)})})},Q()).then(function(){function e(){return zip.generateAsync({type:"blob"}).then(function(e){FileSaver.saveAs(e,"firestop-systems.zip")},function(e){t.innerHTML+=" "+e}),!1}console.log(zip);var t=document.getElementById("download-zip");JSZip.support.blob?bindEvent(t,"click",e):t.innerHTML+=" (not supported on this browser)"})}function updateDataTableSelectAllCtrl(e){var t=e.table().node(),n=$('tbody input[type="checkbox"]',t),a=$('tbody input[type="checkbox"]:checked',t),i=$('thead input[name="select_all"]',e.table().container()).get(0);0===a.length?(i.checked=!1,"indeterminate"in i&&(i.indeterminate=!1)):a.length===n.length?(i.checked=!0,"indeterminate"in i&&(i.indeterminate=!1)):(i.checked=!0,"indeterminate"in i&&(i.indeterminate=!0)),console.log(i.checked,i.indeterminate)}function updateFilesArray(e){var t=[],n="designs/",a=".pdf";return $.each(e,function(e,n){var a="designs/".concat(n,".pdf"),i={filename:n.concat(".pdf"),url:a};t.push(i)}),console.log(t),t}function getFilesArray(){return filesArray}var JSZip=require("jszip"),Q=require("q"),FileSaver=require("file-saver"),downloadFile=function(e){var t=Q.defer(),n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(n.status<400?t.resolve(n.response):t.reject(new Error("Failed to load file from server")))},n.send(),t.promise},zip,files;$(document).ready(function(){function e(){for(var e=document.getElementById("filters"),t=e.getElementsByTagName("input"),a=0,i=t.length;a<i;a++)"checkbox"===t[a].type?t[a].onchange=n:"radio"===t[a].type&&"2"===t[a].name&&(t[a].onchange=n)}function t(){i.api().draw()}function n(){var e=$('input:radio[name="'+this.name+'"]:checked').map(function(){return"ULC"===this.value?"ULC|cUL":"^"+this.value+"$"}).get().join("|"),t=$('input:checkbox[name="'+this.name+'"]:checked').map(function(){return this.value}).get().join("|"),n=e+t;i.fnFilter(n,this.name,!0,!1,!1,!0)}$("#systems").DataTable({ajax:"json/final-ULC.json",columns:[{data:"selected"},{data:"designNumber"},{data:"testingAuthority"},{data:"systemType"},{data:"jointType"},{data:"jointCondition"},{data:"maxJointWidth"},{data:"penetrationCons"},{data:"penetrationType"},{data:"maxSizePenetrant"},{data:"appMethod"},{data:"moveC"},{data:"fRating"},{data:"ftRating"},{data:"fhRating"},{data:"fthRating"},{data:"minASpace"},{data:"maxASpace"},{data:"sleeve"},{data:"insulationType"},{data:"lRating"},{data:"moldMildew"},{data:"seismic"},{data:"wRating"},{data:"stcRating"},{data:"trade"},{data:"products"},{data:"designNumber"}],columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:function(e,t,n,a){return'<input type="checkbox">'}},{class:"short",targets:[3,4]},{targets:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],visible:!1},{targets:27,data:"link",render:function(e,t,n,a){return'<a href="designs/'+e+'.pdf" download><i class="fa fa-download" aria-hidden="true"></i></a>'}}],order:[[1,"asc"]],scrollX:!0,sDom:'<<rt><"paging"lip>>',rowCallback:function(e,t,n){var a=t.designNumber;$.inArray(a,c)!==-1&&($(e).find('input[type="checkbox"]').prop("checked",!0),$(e).addClass("selected"))}});var a=$("#systems").DataTable(),i=$("#systems").dataTable(),c=[],o=[];$("#tableSearch").on("keyup",function(){i.api().search(this.value).draw()}),e(),$("#clear-all").click(function(){$("#filters input[type=checkbox]:checked").each(function(){this.click()});for(var e=document.getElementById("tAuth"),t=e.getElementsByTagName("input"),n=0,a=t.length;n<a;n++)"ULC"===t[n].value?t[n].checked=!0:t[n].checked=!1;document.getElementById("tableSearch").value="",i.fnFilter("ULC|cUL",2,!0,!1,!1,!0),i.api().search("").draw()}),$("#systems tbody").on("click",'input[type="checkbox"]',function(e){console.log(i.api().row(0).data());var t=$(this).closest("tr"),n=i.api().row(t).data(),r=n.designNumber;console.log(n.designNumber);var d=$.inArray(r,c);this.checked&&d===-1?c.push(r):this.checked||d===-1||c.splice(d,1),console.log(c),this.checked?t.addClass("selected"):t.removeClass("selected"),updateDataTableSelectAllCtrl(a),o=updateFilesArray(c),updateDownloadButton(o),e.stopPropagation()}),$("#systems").on("click","tbody td, thead th:first-child",function(e){$(this).parent().find('input[type="checkbox"]').trigger("click")}),$('thead input[name="select_all"]',a.table().container()).on("click",function(e){this.checked?$('#systems tbody input[type="checkbox"]:not(:checked)').trigger("click"):this.indeterminate?(console.log("option 2"),$('#systems tbody input[type="checkbox"]:checked').trigger("click")):$('#systems tbody input[type="checkbox"]:checked').trigger("click"),e.stopPropagation()}),i.on("draw",function(){updateDataTableSelectAllCtrl(a)})});